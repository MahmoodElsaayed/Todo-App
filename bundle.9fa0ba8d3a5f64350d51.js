(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}Math.pow(10,8);const e=Symbol.for("constructDateFrom");function r(t,r){return"function"==typeof t?t(r):t&&"object"==typeof t&&e in t?t[e](r):t instanceof Date?new t.constructor(r):new Date(r)}function n(t,e){return r(e||t,t)}function o(t,e){const r=n(t,e?.in);return r.setHours(0,0,0,0),r}function a(t,...e){const n=r.bind(null,t||e.find((t=>"object"==typeof t)));return e.map(n)}function i(t){const e=n(t),r=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return r.setUTCFullYear(e.getFullYear()),+t-+r}function c(t,e,r){const[n,c]=a(r?.in,t,e),s=l(n,c),u=Math.abs(function(t,e,r){const[n,c]=a(r?.in,t,e),l=o(n),s=o(c),u=+l-i(l),d=+s-i(s);return Math.round((u-d)/864e5)}(n,c));n.setDate(n.getDate()-s*u);const d=s*(u-Number(l(n,c)===-s));return 0===d?0:d}function l(t,e){const r=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return r<0?-1:r>0?1:r}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var u,d=(u=["tasks","projects"],function(){for(var t=0,e=u;t<e.length;t++){var r=e[t];localStorage[r]||(localStorage[r]="[]")}}(),{getStorage:function(t){return u.includes(t)?JSON.parse(localStorage[t]):(console.error("Invalid storage key"),null)},setStorage:function(e,r){return u.includes(e)?"object"!==t(r)||null===r?(console.error("Invalid data"),!1):void(localStorage[e]=JSON.stringify(r)):(console.error("Invalid storage key"),!1)}}),p=function(t){var e="projects",r=t.getStorage(e),n="day";function a(t){n=t}return{addProject:function(n){if(n=n.toLowerCase(),r.includes(n))return console.error("Cannot create duplicate projects"),!1;r.push(n),t.setStorage(e,r)},deleteProject:function(n){var o="tasks",i=r.indexOf(n);if(-1===i)return console.error("Project doesn't exist"),!1;r.splice(i,1),t.setStorage(e,r);var c=t.getStorage(o).filter((function(t){return t.project!==n}));t.setStorage(o,c),a("day")},getProjects:function(){return r},setActiveProject:a,getActiveProject:function(){return n},filterTasksByProject:function(){return t.getStorage("tasks").reduce((function(t,e){var r=o(new Date),a=c(o(new Date(e.date)),r);return("day"===n&&a<=0||"week"===n&&a<=7||n===e.project||"all"===n)&&t.push(e),t}),[])}}}(d),f=function(t,e){var r="tasks",n=t.getStorage(r);function o(t){return n.findIndex((function(e){return e.key===t}))}return{createTask:function(t){var r;return{key:(r=Math.floor(33.5),"abcdefghijklmnopqrstuvwsyzABCDEFGHIJKLMNOPQRSTUVWSYZ0123456789@#$&_".split("").map((function(t){return{c:t,sort:Math.random()}})).sort((function(t,e){return t.sort-e.sort})).map((function(t){return t.c})).join("").slice(r-3,r+3)),title:t.title,description:t.description,date:t.date,priority:t.priority||3,isComplete:t.isComplete||!1,project:e.getActiveProject()}},storeTask:function(e){n.push(e),t.setStorage(r,n)},updateTaskProperty:function(e,a,i){var c=o(e);n[c][a]=i,t.setStorage(r,n)},deleteTask:function(e){var a=o(e);n.splice(a,1),t.setStorage(r,n)},getTasks:function(){return n},getTaskByKey:function(t){return n[o(t)]}}}(d,p);!function(t,e){var r=document.querySelector("#addTaskBtn"),n=document.querySelector("#addProjectBtn"),o=document.querySelectorAll("dialog .cancel-btn"),a=document.querySelector("#taskCreationForm"),i=document.querySelector("#projectCreationForm"),c=document.querySelector(".tasks-container");function l(t){var e={};return t.querySelectorAll(":is(input, select, textarea)").forEach((function(t){"checkbox"!==t.type?e[t.id]=t.value:e[t.id]=t.checked})),e}function u(t){var e="N/A",r=p('<div class=task><div class=main><button class="btn complete-task-btn"></button><p class=title><p class=date></p><button class="btn accordion-btn"></button></div><div class=panel><div class="row title" data-property="title"><button class="btn edit-btn"title="edit property"></button><h4>Title</h4><output></output></div><div class="row description" data-property="description"><button class="btn edit-btn"title="edit property"></button><h4>Description</h4><output></output></div><div class="row date" data-property="date"><button class="btn edit-btn"title="edit property"></button><h4>Date</h4><output></output></div><div class="row priority" data-property="priority"><button class="btn edit-btn"title="edit property"></button><h4>Priority</h4><output></output></div><button class="btn delete-btn"title="delete task"></button></div></div>');return r.dataset.key=t.key,t.isComplete&&r.querySelector(".complete-task-btn").classList.add("completed"),r.querySelector(".main .title").textContent=t.title||e,r.querySelector(".main .date").textContent=t.date||e,r.querySelector(".panel .title output").textContent=t.title||e,r.querySelector(".panel .description output").textContent=t.description||e,r.querySelector(".panel .date output").textContent=t.date||e,r.querySelector(".panel .priority output").textContent=t.priority||e,r.querySelector(".complete-task-btn").addEventListener("click",g),r.querySelector(".accordion-btn").addEventListener("click",(function(t){t.target.closest(".task").classList.toggle("expanded")})),r.querySelector(".delete-btn").addEventListener("click",d),r.querySelectorAll(".edit-btn").forEach((function(t){return t.addEventListener("click",y)})),r}function d(e){var r=e.target.closest(".task");t.deleteTask(r.dataset.key),r.remove()}function p(t){return(new DOMParser).parseFromString(t,"text/html").body.firstChild}function f(e){var r=p('\n            <form class="editing-form">'.concat({title:'<input type="text" id="title" required minlength="1" pattern=".*\\S.*" placeholder="Enter a title" title="Title must contain at least one non-space character."/>',date:'<input type="date" id="date" required />',priority:'<select id="priority" required><option value="" disabled selected>--Select Priority--</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>',description:'<textarea id="description"placeholder="Enter a description" required></textarea>'}[e],'<div class="row flat"><button type="submit" class="submit-btn btn" title="edit task"></button><button type="button" class="cancel-btn btn" title="cancel"></button></div></form>\n        '));return r.querySelector(".cancel-btn").addEventListener("click",v),r.addEventListener("submit",(function(e){e.preventDefault(),function(e){var r,n,o=(r=Object.entries(l(e.target))[0],n=2,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,c=[],l=!0,s=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=a.call(r)).done)&&(c.push(n.value),c.length!==e);l=!0);}catch(t){s=!0,o=t}finally{try{if(!l&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(r,n)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],i=o[1],c=e.target.closest(".task"),u=e.target.previousSibling;t.updateTaskProperty(c.dataset.key,a,i),u.textContent=i,"title"===a&&(c.querySelector(".main .title").textContent=i),"date"===a&&(c.querySelector(".main .date").textContent=i),v(e)}(e)})),r}function y(t){var e=t.target.parentElement;if(!e.querySelector(".editing-form")){var r=e.querySelector("output"),n=f(e.dataset.property);r.style.display="none",e.appendChild(n)}}function v(t){var e=t.target.closest("div[data-property]"),r=e.querySelector("output"),n=e.querySelector(".editing-form");r.style.display="block",n.remove()}function g(e){var r=e.target.closest(".task").dataset.key,n=t.getTaskByKey(r);t.updateTaskProperty(r,"isComplete",!n.isComplete),e.target.classList.toggle("completed")}function b(t,e){e=e.toLowerCase();var r=p({default:'<div class="project" data-filter="'.concat(e,'"><div class="project-icon"></div><p class="project-title">').concat(e[0].toUpperCase()+e.slice(1),"</p></div>"),user:'<div class="project" data-filter="'.concat(e,'"><div class="project-icon"></div><p class="project-title">').concat(e[0].toUpperCase()+e.slice(1),'</p><button class="btn delete-btn"></button></div>')}[t]);return"user"===t&&r.querySelector(".delete-btn").addEventListener("click",m),r.addEventListener("click",(function(t){t.target!==r.querySelector(".delete-btn")&&S(t.target.closest(".project").dataset.filter)})),r}function m(t){var r=t.target.closest(".project"),n=r.dataset.filter;e.deleteProject(n),r.remove(),S()}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"day";["day","week","all"].includes(t)?r.style.display="none":r.style.display="block",e.setActiveProject(t);var n=e.filterTasksByProject(),o=document.querySelector(".tasks-container");o.textContent="",n.forEach((function(t){var e=u(t);o.appendChild(e)})),document.querySelector(".task-viewer .header h2").textContent=t[0].toUpperCase()+t.slice(1)}r.addEventListener("click",(function(){document.querySelector("#addTaskModal").showModal()})),n.addEventListener("click",(function(){document.querySelector("#addProjectModal").showModal()})),o.forEach((function(t){t.addEventListener("click",(function(){t.closest("dialog").close()}))})),a.addEventListener("submit",(function(e){var r=l(e.target);e.target.reset();var n=t.createTask(r);t.storeTask(n);var o=u(n);c.appendChild(o)})),i.addEventListener("submit",(function(t){var r=l(t.target);t.target.reset(),e.addProject(r.title);var n=b("user",r.title);document.querySelector(".user-projects").appendChild(n)})),document.addEventListener("DOMContentLoaded",(function(){var t=e.getProjects(),r=document.querySelector(".default-projects"),n=document.querySelector(".user-projects");["day","week","all"].forEach((function(t){r.appendChild(b("default",t))})),t.forEach((function(t){n.appendChild(b("user",t))}))})),S()}(f,p)})();